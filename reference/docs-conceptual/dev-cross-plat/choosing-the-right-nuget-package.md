---
title: .NET プロジェクトに適した PowerShell NuGet パッケージの選択
description: PowerShell チームによって、各 PowerShell リリースで公開された実行可能パッケージと共に、NuGet から入手できるいくつかのパッケージも保持されます。 これらのパッケージを使用すると、.NET の API プラットフォームとして PowerShell をターゲットにすることができます。
ms.date: 06/25/2020
ms.custom: rjmholt
ms.openlocfilehash: 39369ed872faa76ad2c41d813da5e0a98cf1c078
ms.sourcegitcommit: d0461273abb6db099c5e784ef00f57fd551be4a6
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 07/01/2020
ms.locfileid: "85795321"
---
# <a name="choosing-the-right-powershell-nuget-package-for-your-net-project"></a><span data-ttu-id="167ca-104">.NET プロジェクトに適した PowerShell NuGet パッケージの選択</span><span class="sxs-lookup"><span data-stu-id="167ca-104">Choosing the right PowerShell NuGet package for your .NET project</span></span>

<span data-ttu-id="167ca-105">PowerShell チームによって、各 PowerShell リリースで公開された `pwsh` 実行可能パッケージと共に、[NuGet][] から入手できるいくつかのパッケージも保持されます。</span><span class="sxs-lookup"><span data-stu-id="167ca-105">Alongside the `pwsh` executable packages published with each PowerShell release, the PowerShell team also maintains several packages available on [NuGet][].</span></span> <span data-ttu-id="167ca-106">これらのパッケージを使用すると、.NET の API プラットフォームとして PowerShell をターゲットにすることができます。</span><span class="sxs-lookup"><span data-stu-id="167ca-106">These packages allow targeting PowerShell as an API platform in .NET.</span></span>

<span data-ttu-id="167ca-107">API を提供し、独自のもの (バイナリ モジュール) を実装する .NET ライブラリを読み込むことが想定される .NET アプリケーションとして、PowerShell を NuGet パッケージの形式で使用できるようにすることが不可欠です。</span><span class="sxs-lookup"><span data-stu-id="167ca-107">As a .NET application that provides APIs and expects to load .NET libraries implementing its own (binary modules), it's essential that PowerShell be available in the form of a NuGet package.</span></span>

<span data-ttu-id="167ca-108">現時点で、何らかの表示形式で PowerShell API サーフェス領域を提供する NuGet パッケージがいくつかあります。</span><span class="sxs-lookup"><span data-stu-id="167ca-108">Currently there are several NuGet packages that provide some representation of the PowerShell API surface area.</span></span> <span data-ttu-id="167ca-109">特定のプロジェクトで使用するパッケージが常に明確になっているわけではありません。</span><span class="sxs-lookup"><span data-stu-id="167ca-109">Which package to use with a particular project hasn't always been made clear.</span></span> <span data-ttu-id="167ca-110">この記事では、PowerShell をターゲットとする .NET プロジェクトのいくつかの一般的なシナリオと、PowerShell 指向の .NET プロジェクトのターゲットとなる適切な NuGet パッケージを選択する方法を明確にします。</span><span class="sxs-lookup"><span data-stu-id="167ca-110">This article sheds some light on a few common scenarios for PowerShell-targeting .NET projects and how to choose the right NuGet package to target for your PowerShell-oriented .NET project.</span></span>

## <a name="hosting-vs-referencing"></a><span data-ttu-id="167ca-111">ホスティングと参照</span><span class="sxs-lookup"><span data-stu-id="167ca-111">Hosting vs referencing</span></span>

<span data-ttu-id="167ca-112">.NET プロジェクトには、既存の PowerShell ランタイム (`pwsh`、`powershell.exe`、PowerShell 統合コンソールまたは ISE など) に読み込まれるコードを記述しようとするものもあれば、独自のアプリケーションで PowerShell を実行する必要があるものもあります。</span><span class="sxs-lookup"><span data-stu-id="167ca-112">Some .NET projects seek to write code to be loaded into a pre-existing PowerShell runtime (such as `pwsh`, `powershell.exe`, the PowerShell Integrated Console or the ISE), while others want to run PowerShell in their own applications.</span></span>

- <span data-ttu-id="167ca-113">**参照**は、プロジェクト (通常はモジュール) が PowerShell に読み込まれることを想定している場合です。</span><span class="sxs-lookup"><span data-stu-id="167ca-113">**Referencing** is for when a project, usually a module, is intended to be loaded into PowerShell.</span></span>
  <span data-ttu-id="167ca-114">これは、やりとりするために PowerShell によって提供される API に対してコンパイルする必要がありますが、PowerShell の実装は、それを読み込む PowerShell プロセスによって提供されます。</span><span class="sxs-lookup"><span data-stu-id="167ca-114">It must be compiled against the APIs that PowerShell provides in order to interact with it, but the PowerShell implementation is supplied by the PowerShell process loading it in.</span></span> <span data-ttu-id="167ca-115">参照の場合、プロジェクトで[参照アセンブリ][]または実際のランタイム アセンブリをコンパイル ターゲットとして使用できますが、そのビルドでこれらのいずれも公開されていないことを確実にする必要があります。</span><span class="sxs-lookup"><span data-stu-id="167ca-115">For referencing, a project can use [reference assemblies][] or the actual runtime assemblies as a compilation target, but must ensure that it does not publish any of these with its build.</span></span>
- <span data-ttu-id="167ca-116">**ホスティング**は、プロジェクトで独自の PowerShell の実装が必要な場合です。これは、通常、PowerShell を実行する必要があるスタンドアロン アプリケーションであるためです。</span><span class="sxs-lookup"><span data-stu-id="167ca-116">**Hosting** is when a project needs its own implementation of PowerShell, usually because it is a standalone application that needs to run PowerShell.</span></span> <span data-ttu-id="167ca-117">この場合、純粋な参照アセンブリは使用できません。</span><span class="sxs-lookup"><span data-stu-id="167ca-117">In this case, pure reference assemblies cannot be used.</span></span> <span data-ttu-id="167ca-118">代わりに、PowerShell の具象実装に依存する必要があります。</span><span class="sxs-lookup"><span data-stu-id="167ca-118">Instead, a concrete PowerShell implementation must be depended upon.</span></span> <span data-ttu-id="167ca-119">PowerShell の具象実装を使用する必要があるため、ホスト用に特定のバージョンの PowerShell を選択する必要があります。単一のホスト アプリケーションで、PowerShell の複数のバージョンをターゲットにすることはできません。</span><span class="sxs-lookup"><span data-stu-id="167ca-119">Because a concrete PowerShell implementation must be used, a specific version of PowerShell must be chosen for hosting; a single host application cannot multi-target PowerShell versions.</span></span>

### <a name="publishing-projects-that-target-powershell-as-a-reference"></a><span data-ttu-id="167ca-120">参照として PowerShell をターゲットとするプロジェクトの公開</span><span class="sxs-lookup"><span data-stu-id="167ca-120">Publishing projects that target PowerShell as a reference</span></span>

> [!NOTE]
> <span data-ttu-id="167ca-121">この記事では、**公開**という用語は、`dotnet publish` を実行することを指します。これにより、.NET ライブラリがそのすべての依存関係を持つディレクトリに配置され、特定のランタイムに展開できるようになります。</span><span class="sxs-lookup"><span data-stu-id="167ca-121">We use the term **publish** in this article to refer to running `dotnet publish`, which places a .NET library into a directory with all of its dependencies, ready for deployment to a particular runtime.</span></span>

<span data-ttu-id="167ca-122">コンパイル参照ターゲットとしてのみ使用されているプロジェクトの依存関係を公開しないようにするために、[PrivateAssets 属性][]を設定することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="167ca-122">In order to prevent publishing project dependencies that are just being used as compilation reference targets, it is recommended to set the [PrivateAssets attribute][]:</span></span>

```xml
<PackageReference Include="PowerShellStandard.Library" Version="5.1.0.0" PrivateAssets="all" />
```

<span data-ttu-id="167ca-123">この操作を忘れた場合に、参照アセンブリをターゲットとして使用すると、実際の実装ではなく、参照アセンブリの既定の実装の使用に関する問題が発生する可能性があります。</span><span class="sxs-lookup"><span data-stu-id="167ca-123">If you forget to do this and use a reference assembly as your target, you may see issues related to using the reference assembly's default implementation instead of the actual implementation.</span></span> <span data-ttu-id="167ca-124">参照アセンブリでは多くの場合、`null` を返すだけで実装 API がモックされるため、これは `NullReferenceException` の形式になることがあります。</span><span class="sxs-lookup"><span data-stu-id="167ca-124">This may take the form of a `NullReferenceException`, since reference assemblies often mock the implementation API by simply returning `null`.</span></span>

## <a name="key-kinds-of-powershell-targeting-net-projects"></a><span data-ttu-id="167ca-125">PowerShell をターゲットとする .NET プロジェクト主な種類</span><span class="sxs-lookup"><span data-stu-id="167ca-125">Key kinds of PowerShell-targeting .NET projects</span></span>

<span data-ttu-id="167ca-126">任意の .NET ライブラリまたはアプリケーションで PowerShell を埋め込むことはできますが、PowerShell API を使用する一般的なシナリオがいくつかあります。</span><span class="sxs-lookup"><span data-stu-id="167ca-126">While any .NET library or application can embed PowerShell, there are some common scenarios that use PowerShell APIs:</span></span>

- <span data-ttu-id="167ca-127">**PowerShell バイナリ モジュールの実装**</span><span class="sxs-lookup"><span data-stu-id="167ca-127">**Implementing a PowerShell binary module**</span></span>

  <span data-ttu-id="167ca-128">PowerShell バイナリ モジュールは、PowerShell によって読み込まれる .NET ライブラリであり、それぞれコマンドレットやプロバイダーを公開するために、[PSCmdlet][] や [CmdletProvider][] 型などの PowerShell API を実装する必要があります。</span><span class="sxs-lookup"><span data-stu-id="167ca-128">PowerShell binary modules are .NET libraries loaded by PowerShell that must implement PowerShell APIs like the [PSCmdlet][] or [CmdletProvider][] types in order to expose cmdlets or providers respectively.</span></span> <span data-ttu-id="167ca-129">これらが読み込まれるため、モジュールによって、そのビルドで公開することなく、PowerShell への参照に対するコンパイルが試みられます。</span><span class="sxs-lookup"><span data-stu-id="167ca-129">Because they are loaded in, modules seek to compile against references to PowerShell without publishing it in their build.</span></span> <span data-ttu-id="167ca-130">また、モジュールでは、理想的にはディスク領域、複雑さ、または反復実装のオーバーヘッドが最小限に抑えられる、複数の PowerShell バージョンとプラットフォームをサポートする必要があるのが一般的です。</span><span class="sxs-lookup"><span data-stu-id="167ca-130">It's also common for modules to want to support multiple PowerShell versions and platforms, ideally with a minimum of overhead of disk space, complexity, or repeated implementation.</span></span> <span data-ttu-id="167ca-131">モジュールの詳細については、「[about_Modules][]」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="167ca-131">See [about_Modules][] for more information about modules.</span></span>

- <span data-ttu-id="167ca-132">**PowerShell ホストの実装**</span><span class="sxs-lookup"><span data-stu-id="167ca-132">**Implementing a PowerShell Host**</span></span>

  <span data-ttu-id="167ca-133">PowerShell ホストによって、PowerShell ランタイムの相互作用レイヤーが提供されます。</span><span class="sxs-lookup"><span data-stu-id="167ca-133">A PowerShell Host provides an interaction layer for the PowerShell runtime.</span></span> <span data-ttu-id="167ca-134">これは特定の形式の "_ホスト_" であり、この場合、[PSHost][] は PowerShell への新しいユーザー インターフェイスとして実装されます。</span><span class="sxs-lookup"><span data-stu-id="167ca-134">It is a specific form of _hosting_, where a [PSHost][] is implemented as a new user interface to PowerShell.</span></span> <span data-ttu-id="167ca-135">たとえば、PowerShell ConsoleHost では、PowerShell 実行可能ファイル用のターミナル ユーザー インターフェイスが提供されます。一方、PowerShell エディター サービス ホストと ISE ホストの両方では、PowerShell に関する、エディターに部分的に統合されたグラフィカル ユーザー インターフェイスが提供されます。</span><span class="sxs-lookup"><span data-stu-id="167ca-135">For example, the PowerShell ConsoleHost provides a terminal user interface for PowerShell executables, while the PowerShell Editor Services Host and the ISE Host both provide an editor-integrated partially graphical user interface around PowerShell.</span></span> <span data-ttu-id="167ca-136">既存の PowerShell プロセスにホストを読み込むことはできますが、ホストの実装は、PowerShell エンジンを再配布するスタンドアロンの PowerShell の実装として機能するのがより一般的です。</span><span class="sxs-lookup"><span data-stu-id="167ca-136">While it's possible to load a host onto an existing PowerShell process, it's much more common for a host implementation to act as a standalone PowerShell implementation that redistributes the PowerShell engine.</span></span>

- <span data-ttu-id="167ca-137">**別の .NET アプリケーションからの PowerShell の呼び出し**</span><span class="sxs-lookup"><span data-stu-id="167ca-137">**Calling into PowerShell from another .NET application**</span></span>

  <span data-ttu-id="167ca-138">他のアプリケーションと同様に、PowerShell をサブプロセスとして呼び出し、ワークロードを実行することができます。</span><span class="sxs-lookup"><span data-stu-id="167ca-138">As with any application, PowerShell can be called as a subprocess to run workloads.</span></span> <span data-ttu-id="167ca-139">しかし、.NET アプリケーションとして、PowerShell をインプロセスで呼び出して、呼び出し元のアプリケーション内で使用する完全な .NET オブジェクトを取得することもできます。</span><span class="sxs-lookup"><span data-stu-id="167ca-139">However, as a .NET application, it's also possible to invoke PowerShell in-process to get back full .NET objects for use within the calling application.</span></span> <span data-ttu-id="167ca-140">これは、より一般的な形式の "_ホスト_" であり、この場合、アプリケーションによって、内部使用のためにその独自の PowerShell 実装が保持されます。</span><span class="sxs-lookup"><span data-stu-id="167ca-140">This is a more general form of _hosting_, where the application holds its own PowerShell implementation for internal use.</span></span> <span data-ttu-id="167ca-141">この例として、マシンの状態を管理するために PowerShell を実行するサービスやデーモン、あるいはクラウド配置の管理などの操作の要求に応じて PowerShell を実行する Web アプリケーションなどがあります。</span><span class="sxs-lookup"><span data-stu-id="167ca-141">Examples of this might be a service or daemon running PowerShell to manage machine state or a web application that runs PowerShell on request to do something like manage cloud deployments.</span></span>

- <span data-ttu-id="167ca-142">**.NET からの PowerShell モジュールの単体テスト**</span><span class="sxs-lookup"><span data-stu-id="167ca-142">**Unit testing PowerShell modules from .NET**</span></span>

  <span data-ttu-id="167ca-143">PowerShell に機能を公開するように設計されているモジュールとその他のライブラリは、主に PowerShell からテストする必要があります ([Pester][] を推奨)。場合によっては、.NET から PowerShell モジュール用に記述された API の単体テストが必要になることがあります。</span><span class="sxs-lookup"><span data-stu-id="167ca-143">While modules and other libraries designed to expose functionality to PowerShell should be primarily tested from PowerShell (we recommend [Pester][]), sometimes it's necessary to unit test APIs written for a PowerShell module from .NET.</span></span> <span data-ttu-id="167ca-144">このような状況では、モジュール コードでいくつかの PowerShell バージョンをターゲットにすることが試行されますが、テストでは特定の具象実装で実行する必要があります。</span><span class="sxs-lookup"><span data-stu-id="167ca-144">This situation involves the module code trying to target a number of PowerShell versions, while testing should run it on specific, concrete implementations.</span></span>

## <a name="powershell-nuget-packages-at-a-glance"></a><span data-ttu-id="167ca-145">PowerShell NuGet パッケージの概要</span><span class="sxs-lookup"><span data-stu-id="167ca-145">PowerShell NuGet packages at a glance</span></span>

<span data-ttu-id="167ca-146">この記事では、PowerShell API を公開する次の NuGet パッケージについて説明します。</span><span class="sxs-lookup"><span data-stu-id="167ca-146">In this article, we'll cover the following NuGet packages that expose PowerShell APIs:</span></span>

- <span data-ttu-id="167ca-147">[PowerShellStandard.Library][]。これは、複数の PowerShell ランタイムによって読み込むことができる単一のアセンブリのビルドを可能にする参照アセンブリです。</span><span class="sxs-lookup"><span data-stu-id="167ca-147">[PowerShellStandard.Library][], a reference assembly that enables building a single assembly that can be loaded by multiple PowerShell runtimes.</span></span>
- <span data-ttu-id="167ca-148">[Microsoft.PowerShell.SDK][]。これは、PowerShell SDK 全体をターゲットとし、再ホストする方法です</span><span class="sxs-lookup"><span data-stu-id="167ca-148">[Microsoft.PowerShell.SDK][], the way to target and rehost the whole PowerShell SDK</span></span>
- <span data-ttu-id="167ca-149">[System.Management.Automation][] パッケージ。これは、コア PowerShell ランタイムとエンジンの実装であり、最小限のホストされた実装と、バージョン固有のターゲット シナリオで役立ちます。</span><span class="sxs-lookup"><span data-stu-id="167ca-149">The [System.Management.Automation][] package, the core PowerShell runtime and engine implementation, that can be useful in minimal hosted implementations and for version-specific targeting scenarios.</span></span>
- <span data-ttu-id="167ca-150">**Windows PowerShell 参照アセンブリ**。これは、Windows PowerShell (PowerShell バージョン 5.1 以下) をターゲットとし、効果的に再ホストする方法です。</span><span class="sxs-lookup"><span data-stu-id="167ca-150">The **Windows PowerShell reference assemblies**, the way to target and effectively rehost Windows PowerShell (PowerShell versions 5.1 and below).</span></span>

> [!NOTE]
> <span data-ttu-id="167ca-151">[PowerShell NuGet][] パッケージは .NET ライブラリ パッケージではありませんが、代わりに PowerShell dotnet グローバル ツールの実装が提供されます。</span><span class="sxs-lookup"><span data-stu-id="167ca-151">The [PowerShell NuGet][] package is not a .NET library package at all, but instead provides the PowerShell dotnet global tool implementation.</span></span> <span data-ttu-id="167ca-152">これは、実行可能ファイルのみが提供されるため、どのプロジェクトでも使用できません。</span><span class="sxs-lookup"><span data-stu-id="167ca-152">This should not be used by any projects, since it only provides an executable.</span></span>

## <a name="powershellstandardlibrary"></a><span data-ttu-id="167ca-153">PowerShellStandard.Library</span><span class="sxs-lookup"><span data-stu-id="167ca-153">PowerShellStandard.Library</span></span>

<span data-ttu-id="167ca-154">PowerShell Standard ライブラリは、PowerShell バージョン 7、6、および 5.1 の API の共通部分をキャプチャする参照アセンブリです。</span><span class="sxs-lookup"><span data-stu-id="167ca-154">The PowerShell Standard library is a reference assembly that captures the intersection of the APIs of PowerShell versions 7, 6 and 5.1.</span></span> <span data-ttu-id="167ca-155">これにより、.NET コードをコンパイルするためにコンパイル時にチェックされる API サーフェスが提供され、.NET プロジェクトによって、そこに存在しない API を呼び出すリスクを負うことなく、PowerShell バージョン 7、6、5.1 をターゲットにすることができます。</span><span class="sxs-lookup"><span data-stu-id="167ca-155">This provides a compile-time-checked API surface to compile .NET code against, allowing .NET projects to target PowerShell versions 7, 6 and 5.1 without risking calling an API that won't be there.</span></span>

<span data-ttu-id="167ca-156">PowerShell Standard は、PowerShell モジュールを記述することを目的としています。また、PowerShell プロセスに読み込まれた後に実行することのみを目的とした他のコードを記述することもできます。</span><span class="sxs-lookup"><span data-stu-id="167ca-156">PowerShell Standard is intended for writing PowerShell modules, or other code only intended to be run after loading it into a PowerShell process.</span></span> <span data-ttu-id="167ca-157">これは参照アセンブリであるため、PowerShell Standard 自体には実装は含まれていません。したがって、スタンドアロン アプリケーション用の機能は提供されません。</span><span class="sxs-lookup"><span data-stu-id="167ca-157">Because it is a reference assembly, PowerShell Standard contains no implementation itself, so provides no functionality for standalone applications.</span></span>

### <a name="using-powershell-standard-with-different-net-runtimes"></a><span data-ttu-id="167ca-158">異なる .NET ランタイムでの PowerShell Standard の使用</span><span class="sxs-lookup"><span data-stu-id="167ca-158">Using PowerShell Standard with different .NET runtimes</span></span>

<span data-ttu-id="167ca-159">PowerShell Standard は、[.NET Standard 2.0][] ターゲット ランタイムをターゲットとしています。これは、.NET Framework および .NET Core によって共有される共通のサーフェス領域を提供するように設計されたファサード ランタイムです。</span><span class="sxs-lookup"><span data-stu-id="167ca-159">PowerShell Standard targets the [.NET Standard 2.0][] target runtime, which is a façade runtime designed to provide a common surface area shared by .NET Framework and .NET Core.</span></span> <span data-ttu-id="167ca-160">これにより、単一のランタイムをターゲットとし、複数の PowerShell バージョンで動作する単一のアセンブリを生成できますが、次のような影響があります。</span><span class="sxs-lookup"><span data-stu-id="167ca-160">This allows targeting a single runtime to produce a single assembly that will work with multiple PowerShell versions, but has the following consequences:</span></span>

- <span data-ttu-id="167ca-161">モジュールまたはライブラリを読み込む PowerShell では、少なくとも .NET 4.6.1 を実行する必要があります。 .NET 4.6 と .NET 4.5.2 では、.NET Standard はサポートされていません。</span><span class="sxs-lookup"><span data-stu-id="167ca-161">The PowerShell loading the module or library must be running a minimum of .NET 4.6.1; .NET 4.6 and .NET 4.5.2 do not support .NET Standard.</span></span> <span data-ttu-id="167ca-162">新しい Windows PowerShell のバージョンは、新しい .NET Framework のバージョンを意味するわけではないことにご注意ください。Windows PowerShell 5.1 は、.NET 4.5.2 で実行される場合があります。</span><span class="sxs-lookup"><span data-stu-id="167ca-162">Note that a newer Windows PowerShell version does not mean a newer .NET Framework version; Windows PowerShell 5.1 may run on .NET 4.5.2.</span></span>
- <span data-ttu-id="167ca-163">4\.7.1 以下の .NET Framework が実行されている PowerShell を使用するには、.NET 4.6.1 [NETStandard.Library][] の実装が必要です。これにより、古いバージョンの .NET Framework で netstandard .dll とその他の shim アセンブリが提供されます。</span><span class="sxs-lookup"><span data-stu-id="167ca-163">In order to work with a PowerShell running .NET Framework 4.7.1 or below, the .NET 4.6.1 [NETStandard.Library][] implementation is required to provide the netstandard.dll and other shim assemblies in older .NET Framework versions.</span></span>

<span data-ttu-id="167ca-164">PowerShell 6 以降によって、.NET Framework 4.6.1 (以上) から .NET Core に型転送するための独自の shim アセンブリが提供されます。</span><span class="sxs-lookup"><span data-stu-id="167ca-164">PowerShell 6+ provides its own shim assemblies for type forwarding from .NET Framework 4.6.1 (and above) to .NET Core.</span></span> <span data-ttu-id="167ca-165">これは、.NET Core に存在する API のみがモジュールで使用されている限り、PowerShell 6 以降が、.NET Framework 4.6.1 (`net461` ランタイム ターゲット) 用にビルドされている場合、それを読み込んで実行できることを意味します。</span><span class="sxs-lookup"><span data-stu-id="167ca-165">This means that as long as a module uses only APIs that exist in .NET Core, PowerShell 6+ can load and run it when it has been built for .NET Framework 4.6.1 (the `net461` runtime target).</span></span>

<span data-ttu-id="167ca-166">つまり、公開された単一の DLL を持つ複数の PowerShell バージョンをターゲットとするために PowerShell Standard を使用するバイナリ モジュールには、次の 2 つのオプションがあります。</span><span class="sxs-lookup"><span data-stu-id="167ca-166">This means that binary modules using PowerShell Standard to target multiple PowerShell versions with a single published DLL have two options:</span></span>

1. <span data-ttu-id="167ca-167">`net461` ターゲット ランタイム用にビルドされたアセンブリの公開。</span><span class="sxs-lookup"><span data-stu-id="167ca-167">Publishing an assembly built for the `net461` target runtime.</span></span> <span data-ttu-id="167ca-168">これには以下が含まれます。</span><span class="sxs-lookup"><span data-stu-id="167ca-168">This involves:</span></span>
   - <span data-ttu-id="167ca-169">`net461` ランタイム用のプロジェクトの公開</span><span class="sxs-lookup"><span data-stu-id="167ca-169">Publishing the project for the `net461` runtime</span></span>
   - <span data-ttu-id="167ca-170">また、使用されているすべての API が .NET Core にも存在することを保証するための、(ビルド出力を使用しない) `netstandard2.0` ランタイムに対するコンパイル。</span><span class="sxs-lookup"><span data-stu-id="167ca-170">Also compiling against the `netstandard2.0` runtime (without using its build output) to ensure that all APIs used are also present in .NET Core.</span></span>

1. <span data-ttu-id="167ca-171">`netstandard2.0` ターゲット ランタイム用にビルドされたアセンブリの公開。</span><span class="sxs-lookup"><span data-stu-id="167ca-171">Publishing an assembly build for the `netstandard2.0` target runtime.</span></span> <span data-ttu-id="167ca-172">これには以下が必要です。</span><span class="sxs-lookup"><span data-stu-id="167ca-172">This requires:</span></span>
   - <span data-ttu-id="167ca-173">`netstandard2.0` ランタイム用のプロジェクトの公開</span><span class="sxs-lookup"><span data-stu-id="167ca-173">Publishing the project for the `netstandard2.0` runtime</span></span>
   - <span data-ttu-id="167ca-174">NETStandard.Library の `net461` 依存関係の取得と、プロジェクト アセンブリの公開場所へのコピー。これにより、アセンブリは .NET Framework で適切に型転送されるようになります。</span><span class="sxs-lookup"><span data-stu-id="167ca-174">Taking the `net461` dependencies of NETStandard.Library and copying them into the project assembly's publish location so that the assembly is type-forwarded corrected in .NET Framework.</span></span>

<span data-ttu-id="167ca-175">古いバージョンの .NET Framework をターゲットとする PowerShell モジュールまたはライブラリをビルドするために、複数の .NET ランタイムをターゲットにすることをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="167ca-175">To build PowerShell modules or libraries targeting older .NET Framework versions, it may be preferable to target multiple .NET runtimes.</span></span> <span data-ttu-id="167ca-176">これにより、ターゲット ランタイムごとにアセンブリが公開されます。また、適切なアセンブリをモジュールの読み込み時に読み込む必要があります (たとえば、ルート モジュールとして小さな psm1 を使用する場合)。</span><span class="sxs-lookup"><span data-stu-id="167ca-176">This will publish an assembly for each target runtime, and the correct assembly will need to be loaded at module load time (for example with a small psm1 as the root module).</span></span>

### <a name="testing-powershell-standard-projects-in-net"></a><span data-ttu-id="167ca-177">.NET での PowerShell Standard プロジェクトのテスト</span><span class="sxs-lookup"><span data-stu-id="167ca-177">Testing PowerShell Standard projects in .NET</span></span>

<span data-ttu-id="167ca-178">xUnit のような .NET テスト ランナーでのモジュールのテストに関しては、コンパイル時のチェックでしかないことにご注意ください。</span><span class="sxs-lookup"><span data-stu-id="167ca-178">When it comes to testing your module in .NET test runners like xUnit, remember that compile-time checks can only go so far.</span></span> <span data-ttu-id="167ca-179">モジュールは、関連する PowerShell プラットフォームに対してテストする必要があります。</span><span class="sxs-lookup"><span data-stu-id="167ca-179">You must test your module against the relevant PowerShell platforms.</span></span>

<span data-ttu-id="167ca-180">.NET で PowerShell Standard に対してビルドされた API をテストするには、`Microsoft.Powershell.SDK` を .NET Core とのテスト依存関係として (バージョンが目的の PowerShell バージョンと一致するように設定する)、また、.NET Framework に適した Windows PowerShell 参照アセンブリを追加する必要があります。</span><span class="sxs-lookup"><span data-stu-id="167ca-180">To test APIs built against PowerShell Standard in .NET, you should add `Microsoft.Powershell.SDK` as a testing dependency with .NET Core (with the version set to match the desired PowerShell version), and the appropriate Windows PowerShell reference assemblies with .NET Framework.</span></span>

<span data-ttu-id="167ca-181">PowerShell Standard と、それを使用して複数の PowerShell バージョンで動作するバイナリ モジュールを記述する方法について詳しくは、[こちらのブログ記事][]を参照してください。</span><span class="sxs-lookup"><span data-stu-id="167ca-181">For more information on PowerShell Standard and using it to write a binary module that works in multiple PowerShell versions, see [this blog post][].</span></span> <span data-ttu-id="167ca-182">GitHub の [PowerShell Standard リポジトリ][]も参照してください。</span><span class="sxs-lookup"><span data-stu-id="167ca-182">Also see the [PowerShell Standard repository][] on GitHub.</span></span>

## <a name="microsoftpowershellsdk"></a><span data-ttu-id="167ca-183">Microsoft.PowerShell.SDK</span><span class="sxs-lookup"><span data-stu-id="167ca-183">Microsoft.PowerShell.SDK</span></span>

<span data-ttu-id="167ca-184">`Microsoft.PowerShell.SDK` は、PowerShell SDK のすべてのコンポーネントを単一の NuGet パッケージにまとめたメタパッケージです。</span><span class="sxs-lookup"><span data-stu-id="167ca-184">`Microsoft.PowerShell.SDK` is a meta-package that pulls together all of the components of the PowerShell SDK into a single NuGet package.</span></span> <span data-ttu-id="167ca-185">自己完結型の .NET アプリケーションにより、外部の PowerShell インストールまたはライブラリに依存することなく、任意の PowerShell 機能を実行するために Microsoft.PowerShell.SDK を使用できます。</span><span class="sxs-lookup"><span data-stu-id="167ca-185">A self-contained .NET application can use Microsoft.PowerShell.SDK to run arbitrary PowerShell functionality without depending on any external PowerShell installations or libraries.</span></span>

> [!NOTE]
> <span data-ttu-id="167ca-186">PowerShell SDK は単に、PowerShell を構成し、PowerShell での .NET の開発に使用できる、すべてのコンポーネント パッケージを示すものです。</span><span class="sxs-lookup"><span data-stu-id="167ca-186">The PowerShell SDK just refers to all the component packages that make up PowerShell, and which can be used for .NET development with PowerShell.</span></span>

<span data-ttu-id="167ca-187">特定の `Microsoft.Powershell.SDK` バージョンには、同じバージョンの PowerShell アプリケーションの具象実装が含まれています。バージョン 7.0 には、PowerShell 7.0 の実装が含まれており、それを使用してコマンドまたはスクリプトを実行すると、PowerShell 7.0 で実行する場合とほとんど同じ動作になります。</span><span class="sxs-lookup"><span data-stu-id="167ca-187">A given `Microsoft.Powershell.SDK` version contains the concrete implementation of the same version of the PowerShell application; version 7.0 contains the implementation of PowerShell 7.0 and running commands or scripts with it will largely behave like running them in PowerShell 7.0.</span></span>

<span data-ttu-id="167ca-188">SDK から PowerShell コマンドを実行することは、`pwsh` から実行する場合とほとんど同じですが、まったく同じではありません。</span><span class="sxs-lookup"><span data-stu-id="167ca-188">Running PowerShell commands from the SDK is mostly, but not totally, the same as running them from `pwsh`.</span></span> <span data-ttu-id="167ca-189">たとえば、[Start-Job][] は現在、使用可能な `pwsh` 実行可能ファイルに依存しているため、既定では `Microsoft.Powershell.SDK` と連動しません。</span><span class="sxs-lookup"><span data-stu-id="167ca-189">For example, [Start-Job][] currently depends on the `pwsh` executable being available, and so will not work with `Microsoft.Powershell.SDK` by default.</span></span>

<span data-ttu-id="167ca-190">.NET アプリケーションから `Microsoft.Powershell.SDK` をターゲットとして設定することで、`System.Management.Automation`、`Microsoft.PowerShell.Management`、およびその他のモジュール アセンブリなど、PowerShell のすべての実装アセンブリと統合できます。</span><span class="sxs-lookup"><span data-stu-id="167ca-190">Targeting `Microsoft.Powershell.SDK` from a .NET application allows you to integrate with all of PowerShell's implementation assemblies, such as `System.Management.Automation`, `Microsoft.PowerShell.Management`, and other module assemblies.</span></span>

<span data-ttu-id="167ca-191">`Microsoft.Powershell.SDK` をターゲットとするアプリケーションの公開には、これらのすべてのアセンブリと、PowerShell に必要なすべての依存関係が含まれます。</span><span class="sxs-lookup"><span data-stu-id="167ca-191">Publishing an application targeting `Microsoft.Powershell.SDK` will include all these assemblies, and any dependencies PowerShell requires.</span></span> <span data-ttu-id="167ca-192">また、`Microsoft.PowerShell.*` モジュールのモジュール マニフェストや、[Add-Type][] で必要な `ref` ディレクトリなど、PowerShell でそのビルドに必要だった他のアセットも含まれます。</span><span class="sxs-lookup"><span data-stu-id="167ca-192">It will also include other assets that PowerShell required in its build, such as the module manifests for `Microsoft.PowerShell.*` modules and the `ref` directory required by [Add-Type][].</span></span>

<span data-ttu-id="167ca-193">`Microsoft.Powershell.SDK` の完全性を考えると、次の場合に最適です。</span><span class="sxs-lookup"><span data-stu-id="167ca-193">Given the completeness of `Microsoft.Powershell.SDK`, it's best suited for:</span></span>

- <span data-ttu-id="167ca-194">PowerShell ホストの実装。</span><span class="sxs-lookup"><span data-stu-id="167ca-194">Implementation of PowerShell hosts.</span></span>
- <span data-ttu-id="167ca-195">PowerShell 参照アセンブリをターゲットとするライブラリの xUnit テスト。</span><span class="sxs-lookup"><span data-stu-id="167ca-195">xUnit testing of libraries targeting PowerShell reference assemblies.</span></span>
- <span data-ttu-id="167ca-196">.NET アプリケーションからの PowerShell のインプロセス呼び出し。</span><span class="sxs-lookup"><span data-stu-id="167ca-196">Invoking PowerShell in-process from a .NET application.</span></span>

<span data-ttu-id="167ca-197">`Microsoft.PowerShell.SDK` を参照ターゲットとして使用することもできます。その場合、.NET プロジェクトがモジュールとして使用されるか、PowerShell によって読み込まれることが意図されますが、特定のバージョンの PowerShell にのみ存在する API に依存します。</span><span class="sxs-lookup"><span data-stu-id="167ca-197">`Microsoft.PowerShell.SDK` may also be used as a reference target when a .NET project is intended to be used as a module or otherwise loaded by PowerShell, but depends on APIs only present in a particular version of PowerShell.</span></span> <span data-ttu-id="167ca-198">特定のバージョンの `Microsoft.PowerShell.SDK` に対して公開されたアセンブリは、そのバージョンの PowerShell でのみ、安全に読み込んで使用できることにご注意ください。</span><span class="sxs-lookup"><span data-stu-id="167ca-198">Note that an assembly published against a specific version of `Microsoft.PowerShell.SDK` will only be safe to load and use in that version of PowerShell.</span></span> <span data-ttu-id="167ca-199">特定の API を使用して複数の PowerShell バージョンをターゲットにするには、複数のビルドが必要であり、それぞれが独自のバージョンの `Microsoft.Powershell.SDK` をターゲットとします。</span><span class="sxs-lookup"><span data-stu-id="167ca-199">To target multiple PowerShell versions with specific APIs, multiple builds are required, each targeting their own version of `Microsoft.Powershell.SDK`.</span></span>

> [!NOTE]
> <span data-ttu-id="167ca-200">PowerShell SDK は、PowerShell バージョン 6 以上でのみ使用できます。</span><span class="sxs-lookup"><span data-stu-id="167ca-200">The PowerShell SDK is only available for PowerShell versions 6 and up.</span></span> <span data-ttu-id="167ca-201">Windows PowerShell と同等の機能を提供するには、以下に説明する Windows PowerShell 参照アセンブリを使用します。</span><span class="sxs-lookup"><span data-stu-id="167ca-201">To provide equivalent functionality with Windows PowerShell, use the Windows PowerShell reference assemblies described below.</span></span>

## <a name="systemmanagementautomation"></a><span data-ttu-id="167ca-202">System.Management.Automation</span><span class="sxs-lookup"><span data-stu-id="167ca-202">System.Management.Automation</span></span>

<span data-ttu-id="167ca-203">`System.Management.Automation` パッケージは、PowerShell SDK の中核となるものです。</span><span class="sxs-lookup"><span data-stu-id="167ca-203">The `System.Management.Automation` package is the heart of the PowerShell SDK.</span></span> <span data-ttu-id="167ca-204">これは主に、プルする `Microsoft.Powershell.SDK` のアセットとして NuGet に存在します。</span><span class="sxs-lookup"><span data-stu-id="167ca-204">It exists on NuGet, primarily, as an asset for `Microsoft.Powershell.SDK` to pull in.</span></span> <span data-ttu-id="167ca-205">しかし、小規模なホスティング シナリオやバージョンをターゲットとするモジュールのパッケージとして直接使用することもできます。</span><span class="sxs-lookup"><span data-stu-id="167ca-205">However, it can also be used directly as a package for smaller hosting scenarios and version-targeting modules.</span></span>

<span data-ttu-id="167ca-206">具体的には、次のような場合に、PowerShell 機能を提供するのに `System.Management.Automation` パッケージが適していることがあります。</span><span class="sxs-lookup"><span data-stu-id="167ca-206">Specifically, the `System.Management.Automation` package may be a preferable provider of PowerShell functionality when:</span></span>

- <span data-ttu-id="167ca-207">PowerShell パーサー、AST、AST ビジター API (たとえば、PowerShell の静的分析用) などの PowerShell 言語機能のみを (`System.Management.Automation.Language` 名前空間で) 使用しようとしている。</span><span class="sxs-lookup"><span data-stu-id="167ca-207">You're only looking to use PowerShell language functionality (in the `System.Management.Automation.Language` namespace) like the PowerShell parser, AST, and AST visitor APIs (for example for static analysis of PowerShell).</span></span>
- <span data-ttu-id="167ca-208">`Microsoft.PowerShell.Core` モジュールから特定のコマンドのみを実行したいと考えており、[CreateDefault2][] ファクトリ メソッドで作成されたセッション状態で実行することができる。</span><span class="sxs-lookup"><span data-stu-id="167ca-208">You only wish to execute specific commands from the `Microsoft.PowerShell.Core` module and can execute them in a session state created with the [CreateDefault2][] factory method.</span></span>

<span data-ttu-id="167ca-209">また、`System.Management.Automation` は、次の場合に便利な参照アセンブリです。</span><span class="sxs-lookup"><span data-stu-id="167ca-209">Additionally, `System.Management.Automation` is a useful reference assembly when:</span></span>

- <span data-ttu-id="167ca-210">特定の PowerShell バージョン内にのみ存在する API をターゲットにしたい</span><span class="sxs-lookup"><span data-stu-id="167ca-210">You wish to target APIs that are only present within a specific PowerShell version</span></span>
- <span data-ttu-id="167ca-211">`System.Management.Automation` アセンブリの外部で発生する型 (たとえば、`Microsoft.PowerShell.*` モジュールのコマンドレットによってエクスポートされた型) には依存しない。</span><span class="sxs-lookup"><span data-stu-id="167ca-211">You won't be depending on types occurring outside the `System.Management.Automation` assembly (for example, types exported by cmdlets in `Microsoft.PowerShell.*` modules).</span></span>

## <a name="windows-powershell-reference-assemblies"></a><span data-ttu-id="167ca-212">Windows PowerShell 参照アセンブリ</span><span class="sxs-lookup"><span data-stu-id="167ca-212">Windows PowerShell reference assemblies</span></span>

<span data-ttu-id="167ca-213">PowerShell バージョン 5.1 以前 (Windows PowerShell) では、Windows PowerShell の実装は Windows の一部であるため、PowerShell の実装を提供する SDK はありません。</span><span class="sxs-lookup"><span data-stu-id="167ca-213">For PowerShell versions 5.1 and older (Windows PowerShell), there is no SDK to provide an implementation of PowerShell, since Windows PowerShell's implementation is a part of Windows.</span></span>

<span data-ttu-id="167ca-214">代わりに、Windows PowerShell 参照アセンブリでは、参照ターゲットと、Windows PowerShell を再ホストする方法の両方が提供されます。これは、バージョン 6 以上での PowerShell SDK の場合と同じように動作します。</span><span class="sxs-lookup"><span data-stu-id="167ca-214">Instead, the Windows PowerShell reference assemblies provide both reference targets and a way to rehost Windows PowerShell, acting the same as the PowerShell SDK does for versions 6 and up.</span></span>

<span data-ttu-id="167ca-215">Windows PowerShell 参照アセンブリには、バージョンで区別されるのではなく、Windows PowerShell のバージョンごとに異なるパッケージがあります。</span><span class="sxs-lookup"><span data-stu-id="167ca-215">Rather than being differentiated by version, Windows PowerShell reference assemblies have a different package for each version of Windows PowerShell:</span></span>

- [<span data-ttu-id="167ca-216">PowerShell 5.1</span><span class="sxs-lookup"><span data-stu-id="167ca-216">PowerShell 5.1</span></span>](https://www.nuget.org/packages/Microsoft.PowerShell.5.ReferenceAssemblies/)
- [<span data-ttu-id="167ca-217">PowerShell 4</span><span class="sxs-lookup"><span data-stu-id="167ca-217">PowerShell 4</span></span>](https://www.nuget.org/packages/Microsoft.PowerShell.4.ReferenceAssemblies/)
- [<span data-ttu-id="167ca-218">PowerShell 3</span><span class="sxs-lookup"><span data-stu-id="167ca-218">PowerShell 3</span></span>](https://www.nuget.org/packages/Microsoft.PowerShell.3.ReferenceAssemblies/)

<span data-ttu-id="167ca-219">Windows PowerShell 参照アセンブリの使用方法については、[Windows PowerShell SDK][] に関するページを参照してください。</span><span class="sxs-lookup"><span data-stu-id="167ca-219">Information on how to use the Windows PowerShell reference assemblies can be found in the [Windows PowerShell SDK][].</span></span>

## <a name="real-world-examples-using-these-nuget-packages"></a><span data-ttu-id="167ca-220">これらの NuGet パッケージを使用した実際の例</span><span class="sxs-lookup"><span data-stu-id="167ca-220">Real-world examples using these NuGet packages</span></span>

<span data-ttu-id="167ca-221">異なる PowerShell ツール プロジェクトでは、それぞれのニーズに応じて異なる PowerShell NuGet パッケージがターゲットとなります。</span><span class="sxs-lookup"><span data-stu-id="167ca-221">Different PowerShell tooling projects target different PowerShell NuGet packages depending on their needs.</span></span> <span data-ttu-id="167ca-222">いくつかの注目すべき例の一覧を以下に示します。</span><span class="sxs-lookup"><span data-stu-id="167ca-222">Listed here are some notable examples.</span></span>

### <a name="psreadline"></a><span data-ttu-id="167ca-223">PSReadLine</span><span class="sxs-lookup"><span data-stu-id="167ca-223">PSReadLine</span></span>

<span data-ttu-id="167ca-224">[PSReadLine][] は、PowerShell の豊富なコンソール エクスペリエンスの多くを提供する PowerShell モジュールであり、特定の PowerShell バージョンではなく、依存関係として PowerShell Standard をターゲットとし、その [csproj][] の `net461` .NET ランタイムをターゲットとします。</span><span class="sxs-lookup"><span data-stu-id="167ca-224">[PSReadLine][], the PowerShell module that provides much of PowerShell's rich console experience, targets PowerShell Standard as a dependency rather than a specific PowerShell version, and targets the `net461` .NET runtime in its [csproj][].</span></span>

<span data-ttu-id="167ca-225">PowerShell 6 以降では独自の shim アセンブリが提供されます。これを使用すれば、`net461` ランタイムをターゲットとする DLL を、(.NET Framework の `mscorlib.dll` へのバインドを関連する .NET Core アセンブリにリダイレクトすることによって) 読み込まれたときに "のみ動作" させることができます。</span><span class="sxs-lookup"><span data-stu-id="167ca-225">PowerShell 6+ supplies its own shim assemblies that allow a DLL targeting the `net461` runtime to "just work" when loaded in (by redirecting binding to .NET Framework's `mscorlib.dll` to the relevant .NET Core assembly).</span></span>

<span data-ttu-id="167ca-226">これにより、PSReadLine のモジュール レイアウトと配信が大幅に簡素化されます。これは、PowerShell Standard により、使用される API のみが PowerShell 5.1 と PowerShell 6 以降の両方に存在することが保証されるだけでなく、単一のアセンブリのみにモジュールを同梱できるためです。</span><span class="sxs-lookup"><span data-stu-id="167ca-226">This simplifies PSReadLine's module layout and delivery significantly, since PowerShell Standard ensures the only APIs used will be present in both PowerShell 5.1 and PowerShell 6+, while also allowing the module to ship with only a single assembly.</span></span>

<span data-ttu-id="167ca-227">.NET 4.6.1 ターゲットは、.NET 4.5.2 と .NET 4.6 で実行されている Windows PowerShell がサポートされないことを意味します。</span><span class="sxs-lookup"><span data-stu-id="167ca-227">The .NET 4.6.1 target does mean that Windows PowerShell running on .NET 4.5.2 and .NET 4.6 is not supported though.</span></span>

### <a name="powershell-editor-services"></a><span data-ttu-id="167ca-228">PowerShell エディター サービス</span><span class="sxs-lookup"><span data-stu-id="167ca-228">PowerShell Editor Services</span></span>

<span data-ttu-id="167ca-229">[PowerShell エディター サービス][] (PSES) は、[Visual Studio Code][] 用の [PowerShell の拡張機能][]のバックエンドです。実際には、PowerShell モジュールの一種であり、PowerShell 実行可能ファイルによって読み込まれ、そのプロセスを引き継いでそれ自体の中に PowerShell を再ホストし、同時に言語サービス プロトコルとデバッグ アダプターの機能も提供します。</span><span class="sxs-lookup"><span data-stu-id="167ca-229">[PowerShell Editor Services][] (PSES) is the backend for the [PowerShell extension][] for [Visual Studio Code][], and is actually a form of PowerShell module that gets loaded by a PowerShell executable and then takes over that process to rehost PowerShell within itself while also providing Language Service Protocol and Debug Adapter features.</span></span>

<span data-ttu-id="167ca-230">PSES によって、PowerShell 6 以降がターゲットとされる場合は `netcoreapp2.1` (PowerShell 7 の `netcoreapp3.1` ランタイムは下位互換性があるため)、Windows PowerShell 5.1 がターゲットとされる場合は `net461` の具象実装ターゲットが提供されますが、そのロジックのほとんどは、`netstandard2.0` と PowerShell Standard をターゲットとする 2 番目のアセンブリに含まれています。</span><span class="sxs-lookup"><span data-stu-id="167ca-230">PSES provides concrete implementation targets for `netcoreapp2.1` to target PowerShell 6+ (since PowerShell 7's `netcoreapp3.1` runtime is backwards compatible) and `net461` to target Windows PowerShell 5.1, but contains most of its logic in a second assembly that targets `netstandard2.0` and PowerShell Standard.</span></span> <span data-ttu-id="167ca-231">これにより、.NET Core と .NET Framework プラットフォームに必要な依存関係をプルしながら、統一された抽象化の背後にあるコードベースのほとんどを簡略化できます。</span><span class="sxs-lookup"><span data-stu-id="167ca-231">This allows it to pull in dependencies required for .NET Core and .NET Framework platforms, while still simplifying most of the codebase behind a uniform abstraction.</span></span>

<span data-ttu-id="167ca-232">PSES は PowerShell Standard に対してビルドされているため、正しくテストするには PowerShell のランタイム実装が必要です。</span><span class="sxs-lookup"><span data-stu-id="167ca-232">Because it is built against PowerShell Standard, PSES requires a runtime implementation of PowerShell in order to be tested correctly.</span></span> <span data-ttu-id="167ca-233">これを行うには、テスト環境で PowerShell 実装を提供するために、[PSES の xUnit][] テストで `Microsoft.PowerShell.SDK` および `Microsoft.PowerShell.5.ReferenceAssemblies` をプルします。</span><span class="sxs-lookup"><span data-stu-id="167ca-233">To do this, [PSES's xUnit][] tests pull in `Microsoft.PowerShell.SDK` and `Microsoft.PowerShell.5.ReferenceAssemblies` in order to provide a PowerShell implementation in the test environment.</span></span>

<span data-ttu-id="167ca-234">PSReadLine と同様に、PSES により .NET 4.6 以下はサポートされませんが、下位の .NET Framework ランタイムでクラッシュする可能性がある API のいずれかを呼び出す前に、実行時に[チェックが実行されます][]。</span><span class="sxs-lookup"><span data-stu-id="167ca-234">As with PSReadLine, PSES cannot support .NET 4.6 and below, but it [performs a check][] at runtime before calling any of the APIs that could cause a crash on the lower .NET Framework runtimes.</span></span>

### <a name="psscriptanalyzer"></a><span data-ttu-id="167ca-235">PSScriptAnalyzer</span><span class="sxs-lookup"><span data-stu-id="167ca-235">PSScriptAnalyzer</span></span>

<span data-ttu-id="167ca-236">PowerShell のリンターである、[PSScriptAnalyzer][] では、特定のバージョンの PowerShell で導入された構文要素のみをターゲットにする必要があります。</span><span class="sxs-lookup"><span data-stu-id="167ca-236">[PSScriptAnalyzer][], the linter for PowerShell, must target syntactic elements only introduced in certain versions of PowerShell.</span></span> <span data-ttu-id="167ca-237">これらの構文要素の認識は [AstVisitor2][] を実装することによって行われるため、PowerShellStandard を使用したり、また、新しい PowerShell 構文用に AST ビジター メソッドを実装したりすることはできません。</span><span class="sxs-lookup"><span data-stu-id="167ca-237">Because recognition of these syntactic elements is accomplished by implementing an [AstVisitor2][], it's not possible to use PowerShellStandard and also implement AST visitor methods for newer PowerShell syntaxes.</span></span>

<span data-ttu-id="167ca-238">代わりに、PSScriptAnalyzer では、ビルド構成として[各 PowerShell バージョンをターゲットとします][]。また、それぞれに対して個別の DLL を生成します。</span><span class="sxs-lookup"><span data-stu-id="167ca-238">Instead, PSScriptAnalyzer [targets each PowerShell version][] as a build configuration, and produces a separate DLL for each of them.</span></span> <span data-ttu-id="167ca-239">これにより、ビルドのサイズと複雑さが増しますが、次のことが可能になります。</span><span class="sxs-lookup"><span data-stu-id="167ca-239">This increases build size and complexity, but allows:</span></span>

- <span data-ttu-id="167ca-240">バージョン固有の API ターゲット設定</span><span class="sxs-lookup"><span data-stu-id="167ca-240">Version-specific API targeting</span></span>
- <span data-ttu-id="167ca-241">基本的にランタイム コストなしでのバージョン固有の機能の実装</span><span class="sxs-lookup"><span data-stu-id="167ca-241">Version-specific functionality to be implemented with essentially no runtime cost</span></span>
- <span data-ttu-id="167ca-242">.NET Framework 4.5.2 に至るまでの Windows PowerShell の全面サポート</span><span class="sxs-lookup"><span data-stu-id="167ca-242">Total support for Windows PowerShell all the way down to .NET Framework 4.5.2</span></span>

## <a name="summary"></a><span data-ttu-id="167ca-243">まとめ</span><span class="sxs-lookup"><span data-stu-id="167ca-243">Summary</span></span>

<span data-ttu-id="167ca-244">この記事では、PowerShell を使用する .NET プロジェクトを実装するときにターゲットとして使用可能な NuGet パッケージと、一方を他方より優先して使用する理由を一覧にして説明しました。</span><span class="sxs-lookup"><span data-stu-id="167ca-244">In this article, we've listed and discussed the NuGet packages available to target when implementing a .NET project that uses PowerShell, and the reasons you might have for using one over another.</span></span>

<span data-ttu-id="167ca-245">まとめまでスキップした場合、次のような広範な推奨事項がいくつかあります。</span><span class="sxs-lookup"><span data-stu-id="167ca-245">If you've skipped to the summary, some broad recommendations are:</span></span>

- <span data-ttu-id="167ca-246">PowerShell **モジュール**は、異なる PowerShell バージョンに共通する API のみが必要な場合、PowerShell Standard に対してコンパイルする必要があります。</span><span class="sxs-lookup"><span data-stu-id="167ca-246">PowerShell **modules** should compile against PowerShell Standard if they only require APIs common to different PowerShell versions.</span></span>
- <span data-ttu-id="167ca-247">PowerShell を内部的に実行する必要がある PowerShell の**ホストとアプリケーション**では、PowerShell 6 以降用の PowerShell SDK、または Windows PowerShell 用の関連する Windows PowerShell 参照アセンブリをターゲットにする必要があります。</span><span class="sxs-lookup"><span data-stu-id="167ca-247">PowerShell **hosts and applications** that need to run PowerShell internally should target the PowerShell SDK for PowerShell 6+ or the relevant Windows PowerShell reference assemblies for Windows PowerShell.</span></span>
- <span data-ttu-id="167ca-248">**バージョン固有の API** を必要とする PowerShell モジュールでは、必要な PowerShell バージョン用の PowerShell SDK または Windows PowerShell 参照アセンブリをターゲットにする必要があります。これらは参照アセンブリとして使用されます (つまり、PowerShell の依存関係は公開されません)。</span><span class="sxs-lookup"><span data-stu-id="167ca-248">PowerShell modules that need **version-specific APIs** should target the PowerShell SDK or Windows PowerShell reference assemblies for the required PowerShell versions, using them as reference assemblies (that is, not publishing the PowerShell dependencies).</span></span>

<!--link references -->

[.NET Standard 2.0]: /dotnet/standard/net-standard
[about_Modules]: /powershell/module/microsoft.powershell.core/about/about_modules
[Add-Type]: /powershell/module/microsoft.powershell.utility/add-type
[AstVisitor2]: /dotnet/api/system.management.automation.language.astvisitor2
[CmdletProvider]: /dotnet/api/system.management.automation.provider.cmdletprovider
[CreateDefault2]: /dotnet/api/system.management.automation.runspaces.initialsessionstate.createdefault2
[csproj]: https://github.com/PowerShell/PSReadLine/blob/master/PSReadLine/PSReadLine.csproj
[Microsoft.PowerShell.SDK]: https://www.nuget.org/packages/Microsoft.PowerShell.SDK/
[NETStandard.Library]: https://www.nuget.org/packages/NETStandard.Library/
[NuGet]: https://www.nuget.org/
[チェックが実行されます]: https://github.com/PowerShell/PowerShellEditorServices/blob/8c500ee1752201d3c1cc2e5d90f1a2af3b1eb15d/src/PowerShellEditorServices.Hosting/EditorServicesLoader.cs#L231-L251
[performs a check]: https://github.com/PowerShell/PowerShellEditorServices/blob/8c500ee1752201d3c1cc2e5d90f1a2af3b1eb15d/src/PowerShellEditorServices.Hosting/EditorServicesLoader.cs#L231-L251
[Pester]: https://github.com/Pester/Pester
[PowerShell エディター サービス]: https://github.com/PowerShell/PowerShellEditorServices/
[PowerShell Editor Services]: https://github.com/PowerShell/PowerShellEditorServices/
[PowerShell の拡張機能]: https://marketplace.visualstudio.com/items?itemName=ms-vscode.PowerShell
[PowerShell extension]: https://marketplace.visualstudio.com/items?itemName=ms-vscode.PowerShell
[PowerShell NuGet]: https://www.nuget.org/packages/PowerShell/
[PowerShell Standard リポジトリ]: https://github.com/PowerShell/PowerShellStandard
[PowerShell Standard repository]: https://github.com/PowerShell/PowerShellStandard
[PowerShellStandard.Library]: https://www.nuget.org/packages/PowerShellStandard.Library/
[PSCmdlet]: /dotnet/api/system.management.automation.pscmdlet
[PSES の xUnit]: https://github.com/PowerShell/PowerShellEditorServices/blob/8c500ee1752201d3c1cc2e5d90f1a2af3b1eb15d/test/PowerShellEditorServices.Test/PowerShellEditorServices.Test.csproj#L15-L20
[PSES's xUnit]: https://github.com/PowerShell/PowerShellEditorServices/blob/8c500ee1752201d3c1cc2e5d90f1a2af3b1eb15d/test/PowerShellEditorServices.Test/PowerShellEditorServices.Test.csproj#L15-L20
[PSHost]: /dotnet/api/system.management.automation.host.pshost
[PrivateAssets 属性]: /dotnet/core/tools/csproj#packagereference
[PrivateAssets attribute]: /dotnet/core/tools/csproj#packagereference
[PSReadLine]: https://github.com/PowerShell/PSReadLine
[PSScriptAnalyzer]: https://github.com/powershell/psscriptanalyzer
[参照アセンブリ]: https://github.com/dotnet/standard/blob/master/docs/history/evolution-of-design-time-assemblies.md#definitions
[reference assemblies]: https://github.com/dotnet/standard/blob/master/docs/history/evolution-of-design-time-assemblies.md#definitions
[Start-Job]: /powershell/module/microsoft.powershell.core/start-job
[System.Management.Automation]: https://www.nuget.org/packages/System.Management.Automation/
[各 PowerShell バージョンをターゲットとします]: https://github.com/PowerShell/PSScriptAnalyzer/blob/master/Engine/Engine.csproj
[targets each PowerShell version]: https://github.com/PowerShell/PSScriptAnalyzer/blob/master/Engine/Engine.csproj
[こちらのブログ記事]: https://devblogs.microsoft.com/powershell/powershell-standard-library-build-single-module-that-works-across-windows-powershell-and-powershell-core/
[this blog post]: https://devblogs.microsoft.com/powershell/powershell-standard-library-build-single-module-that-works-across-windows-powershell-and-powershell-core/
[Visual Studio Code]: https://code.visualstudio.com/
[Windows PowerShell SDK]: /powershell/scripting/developer/windows-powershell
